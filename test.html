<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FireLives - API Test</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #1a1a1a;
            color: #00ff00;
            padding: 2rem;
            line-height: 1.6;
        }
        h1 {
            color: #ff4500;
            text-align: center;
        }
        .test-section {
            background: #2a2a2a;
            border: 2px solid #ff8c00;
            border-radius: 10px;
            padding: 1.5rem;
            margin: 1rem 0;
        }
        .test-section h2 {
            color: #ff8c00;
            margin-bottom: 1rem;
        }
        button {
            background: linear-gradient(135deg, #ff4500, #ff8c00);
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 5px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            margin: 0.5rem;
        }
        button:hover {
            opacity: 0.8;
        }
        pre {
            background: #000;
            padding: 1rem;
            border-radius: 5px;
            overflow-x: auto;
            max-height: 400px;
            overflow-y: auto;
        }
        .status {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-weight: bold;
            margin-left: 1rem;
        }
        .status.success {
            background: #00ff00;
            color: #000;
        }
        .status.error {
            background: #ff0000;
            color: #fff;
        }
        .status.pending {
            background: #ffaa00;
            color: #000;
        }
    </style>
</head>
<body>
    <h1>ðŸ”¥ FireLives API Test Suite ðŸ”¥</h1>

    <div class="test-section">
        <h2>1. Server Health Check <span id="health-status" class="status pending">PENDING</span></h2>
        <button onclick="testHealth()">Test Health Endpoint</button>
        <pre id="health-result">Click button to test...</pre>
    </div>

    <div class="test-section">
        <h2>2. Fetch Streams <span id="streams-status" class="status pending">PENDING</span></h2>
        <button onclick="testStreams()">Get All Streams</button>
        <button onclick="testStreamsWithSearch()">Search "jazz"</button>
        <button onclick="testStreamsWithCategory()">Filter "Music"</button>
        <pre id="streams-result">Click button to test...</pre>
    </div>

    <div class="test-section">
        <h2>3. Top Streams <span id="top-status" class="status pending">PENDING</span></h2>
        <button onclick="testTopStreams()">Get Top 10 Streams</button>
        <pre id="top-result">Click button to test...</pre>
    </div>

    <div class="test-section">
        <h2>4. Categories <span id="categories-status" class="status pending">PENDING</span></h2>
        <button onclick="testCategories()">Get Categories</button>
        <pre id="categories-result">Click button to test...</pre>
    </div>

    <div class="test-section">
        <h2>5. Direct Radio Browser API <span id="direct-status" class="status pending">PENDING</span></h2>
        <button onclick="testDirectAPI()">Test Direct API</button>
        <pre id="direct-result">Click button to test...</pre>
    </div>

    <div class="test-section">
        <h2>ðŸ“Š Test Summary</h2>
        <pre id="summary">Run tests to see summary...</pre>
    </div>

    <script>
        const API_BASE = 'http://localhost:3000';
        let testResults = {
            health: null,
            streams: null,
            top: null,
            categories: null,
            direct: null
        };

        async function testHealth() {
            const resultEl = document.getElementById('health-result');
            const statusEl = document.getElementById('health-status');
            
            try {
                resultEl.textContent = 'Testing...';
                statusEl.textContent = 'TESTING';
                statusEl.className = 'status pending';
                
                const response = await fetch(`${API_BASE}/health`);
                const data = await response.json();
                
                resultEl.textContent = JSON.stringify(data, null, 2);
                statusEl.textContent = 'SUCCESS';
                statusEl.className = 'status success';
                testResults.health = true;
            } catch (error) {
                resultEl.textContent = `Error: ${error.message}`;
                statusEl.textContent = 'FAILED';
                statusEl.className = 'status error';
                testResults.health = false;
            }
            updateSummary();
        }

        async function testStreams() {
            const resultEl = document.getElementById('streams-result');
            const statusEl = document.getElementById('streams-status');
            
            try {
                resultEl.textContent = 'Testing...';
                statusEl.textContent = 'TESTING';
                statusEl.className = 'status pending';
                
                const response = await fetch(`${API_BASE}/api/streams?limit=5`);
                const data = await response.json();
                
                resultEl.textContent = JSON.stringify(data, null, 2);
                statusEl.textContent = 'SUCCESS';
                statusEl.className = 'status success';
                testResults.streams = true;
            } catch (error) {
                resultEl.textContent = `Error: ${error.message}`;
                statusEl.textContent = 'FAILED';
                statusEl.className = 'status error';
                testResults.streams = false;
            }
            updateSummary();
        }

        async function testStreamsWithSearch() {
            const resultEl = document.getElementById('streams-result');
            
            try {
                resultEl.textContent = 'Searching for "jazz"...';
                
                const response = await fetch(`${API_BASE}/api/streams?search=jazz&limit=5`);
                const data = await response.json();
                
                resultEl.textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                resultEl.textContent = `Error: ${error.message}`;
            }
        }

        async function testStreamsWithCategory() {
            const resultEl = document.getElementById('streams-result');
            
            try {
                resultEl.textContent = 'Filtering by "Music"...';
                
                const response = await fetch(`${API_BASE}/api/streams?category=Music&limit=5`);
                const data = await response.json();
                
                resultEl.textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                resultEl.textContent = `Error: ${error.message}`;
            }
        }

        async function testTopStreams() {
            const resultEl = document.getElementById('top-result');
            const statusEl = document.getElementById('top-status');
            
            try {
                resultEl.textContent = 'Testing...';
                statusEl.textContent = 'TESTING';
                statusEl.className = 'status pending';
                
                const response = await fetch(`${API_BASE}/api/streams/top?limit=10`);
                const data = await response.json();
                
                resultEl.textContent = JSON.stringify(data, null, 2);
                statusEl.textContent = 'SUCCESS';
                statusEl.className = 'status success';
                testResults.top = true;
            } catch (error) {
                resultEl.textContent = `Error: ${error.message}`;
                statusEl.textContent = 'FAILED';
                statusEl.className = 'status error';
                testResults.top = false;
            }
            updateSummary();
        }

        async function testCategories() {
            const resultEl = document.getElementById('categories-result');
            const statusEl = document.getElementById('categories-status');
            
            try {
                resultEl.textContent = 'Testing...';
                statusEl.textContent = 'TESTING';
                statusEl.className = 'status pending';
                
                const response = await fetch(`${API_BASE}/api/categories`);
                const data = await response.json();
                
                resultEl.textContent = JSON.stringify(data, null, 2);
                statusEl.textContent = 'SUCCESS';
                statusEl.className = 'status success';
                testResults.categories = true;
            } catch (error) {
                resultEl.textContent = `Error: ${error.message}`;
                statusEl.textContent = 'FAILED';
                statusEl.className = 'status error';
                testResults.categories = false;
            }
            updateSummary();
        }

        async function testDirectAPI() {
            const resultEl = document.getElementById('direct-result');
            const statusEl = document.getElementById('direct-status');
            
            try {
                resultEl.textContent = 'Testing direct Radio Browser API...';
                statusEl.textContent = 'TESTING';
                statusEl.className = 'status pending';
                
                const response = await fetch('https://de1.api.radio-browser.info/json/stations/topvote/5');
                const data = await response.json();
                
                resultEl.textContent = JSON.stringify(data, null, 2);
                statusEl.textContent = 'SUCCESS';
                statusEl.className = 'status success';
                testResults.direct = true;
            } catch (error) {
                resultEl.textContent = `Error: ${error.message}`;
                statusEl.textContent = 'FAILED';
                statusEl.className = 'status error';
                testResults.direct = false;
            }
            updateSummary();
        }

        function updateSummary() {
            const summaryEl = document.getElementById('summary');
            const total = Object.values(testResults).filter(v => v !== null).length;
            const passed = Object.values(testResults).filter(v => v === true).length;
            const failed = Object.values(testResults).filter(v => v === false).length;
            
            summaryEl.textContent = `
Tests Run: ${total}
Passed: ${passed} âœ“
Failed: ${failed} âœ—

Details:
- Health Check: ${testResults.health === null ? 'Not Run' : testResults.health ? 'âœ“ PASSED' : 'âœ— FAILED'}
- Streams API: ${testResults.streams === null ? 'Not Run' : testResults.streams ? 'âœ“ PASSED' : 'âœ— FAILED'}
- Top Streams: ${testResults.top === null ? 'Not Run' : testResults.top ? 'âœ“ PASSED' : 'âœ— FAILED'}
- Categories: ${testResults.categories === null ? 'Not Run' : testResults.categories ? 'âœ“ PASSED' : 'âœ— FAILED'}
- Direct API: ${testResults.direct === null ? 'Not Run' : testResults.direct ? 'âœ“ PASSED' : 'âœ— FAILED'}
            `;
        }

        // Auto-run health check on load
        window.addEventListener('load', () => {
            setTimeout(testHealth, 500);
        });
    </script>
</body>
</html>
