<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FireLives - Online Audio Centers</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        /* Additional inline styles for simple version */
        .fire-icon-svg {
            width: 40px;
            height: 40px;
            animation: flicker 2s infinite alternate;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <svg class="fire-icon-svg" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <linearGradient id="fireGrad" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#ff4500;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#ff8c00;stop-opacity:1" />
                        </linearGradient>
                    </defs>
                    <path d="M50 10 Q40 30 45 50 Q35 45 30 60 Q25 75 35 85 Q45 95 55 95 Q65 95 75 85 Q85 75 80 60 Q75 45 65 50 Q70 30 60 10 Q55 20 50 10 Z" fill="url(#fireGrad)"/>
                    <path d="M50 40 Q48 45 49 52 Q47 50 45 55 Q43 60 47 65 Q50 68 53 65 Q57 60 55 55 Q53 50 51 52 Q52 45 50 40 Z" fill="#ff1744"/>
                </svg>
                <span>FireLives</span>
            </div>
            
            <div class="search-container">
                <input type="text" id="searchInput" class="search-bar" placeholder="Search live streams, artists, genres...">
                <button class="search-button" onclick="handleSearch()">üîç Search</button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container">
        <!-- Filters -->
        <div class="filters" id="filters">
            <button class="filter-button active" onclick="handleFilter('All')">All</button>
            <button class="filter-button" onclick="handleFilter('Music')">Music</button>
            <button class="filter-button" onclick="handleFilter('Rock')">Rock</button>
            <button class="filter-button" onclick="handleFilter('Electronic')">Electronic</button>
            <button class="filter-button" onclick="handleFilter('Jazz')">Jazz</button>
            <button class="filter-button" onclick="handleFilter('Hip Hop')">Hip Hop</button>
            <button class="filter-button" onclick="handleFilter('Classical')">Classical</button>
            <button class="filter-button" onclick="handleFilter('Pop')">Pop</button>
            <button class="filter-button" onclick="handleFilter('Talk')">Talk</button>
        </div>

        <!-- Error Message -->
        <div id="errorMessage" class="error-message" style="display: none;">
            <p id="errorText"></p>
            <button class="play-button" onclick="fetchStreams()" style="margin-top: 1rem;">üîÑ Retry</button>
        </div>

        <!-- Loading State -->
        <div id="loading" class="loading">
            <div class="spinner"></div>
        </div>

        <!-- Streams Section -->
        <div id="streamsSection" style="display: none;">
            <h2 class="section-title">Live Now</h2>
            <div class="streams-grid" id="streamsGrid"></div>
        </div>
    </main>

    <!-- Player Bar -->
    <div id="playerBar" class="player-bar" style="display: none;">
        <div class="player-info">
            <div class="player-thumbnail" id="playerThumbnail">
                <svg width="30" height="30" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <linearGradient id="fireGrad2" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#ff4500;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#ff8c00;stop-opacity:1" />
                        </linearGradient>
                    </defs>
                    <path d="M50 10 Q40 30 45 50 Q35 45 30 60 Q25 75 35 85 Q45 95 55 95 Q65 95 75 85 Q85 75 80 60 Q75 45 65 50 Q70 30 60 10 Q55 20 50 10 Z" fill="url(#fireGrad2)"/>
                    <path d="M50 40 Q48 45 49 52 Q47 50 45 55 Q43 60 47 65 Q50 68 53 65 Q57 60 55 55 Q53 50 51 52 Q52 45 50 40 Z" fill="#ff1744"/>
                </svg>
            </div>
            <div class="player-details">
                <h3 id="playerTitle">No stream playing</h3>
                <p id="playerAuthor">Select a stream to play</p>
            </div>
        </div>

        <div class="player-controls">
            <button class="control-button" id="playPauseBtn" onclick="togglePlayPause()">‚ñ∂</button>
            <div class="volume-control">
                <span>üîä</span>
                <input type="range" class="volume-slider" id="volumeSlider" min="0" max="100" value="70" onchange="handleVolumeChange()">
                <span id="volumeText">70%</span>
            </div>
        </div>
    </div>

    <!-- Audio Element -->
    <audio id="audioPlayer" preload="none"></audio>

    <script>
        // Global state
        let allStreams = [];
        let filteredStreams = [];
        let currentStream = null;
        let isPlaying = false;
        const audioPlayer = document.getElementById('audioPlayer');

        // Fetch streams on load
        window.addEventListener('DOMContentLoaded', () => {
            fetchStreams();
        });

        // Fetch live streams
        async function fetchStreams() {
            const loading = document.getElementById('loading');
            const errorMessage = document.getElementById('errorMessage');
            const streamsSection = document.getElementById('streamsSection');
            
            loading.style.display = 'flex';
            errorMessage.style.display = 'none';
            streamsSection.style.display = 'none';

            try {
                const apis = [
                    'https://de1.api.radio-browser.info/json/stations/topvote/30',
                    'https://nl1.api.radio-browser.info/json/stations/topvote/30',
                    'https://at1.api.radio-browser.info/json/stations/topvote/30',
                ];

                let data = null;
                for (const apiUrl of apis) {
                    try {
                        const response = await fetch(apiUrl);
                        if (response.ok) {
                            data = await response.json();
                            if (data && data.length > 0) break;
                        }
                    } catch (err) {
                        console.log('Trying next API...');
                    }
                }

                if (!data || data.length === 0) {
                    throw new Error('Unable to fetch streams');
                }

                allStreams = data.map((station, index) => ({
                    id: station.stationuuid || `stream-${index}`,
                    title: station.name || 'Unknown Station',
                    author: station.country || 'Unknown',
                    listeners: station.votes || Math.floor(Math.random() * 1000),
                    thumbnail: station.favicon || '',
                    category: station.tags ? station.tags.split(',')[0] : 'Music',
                    url: station.url || station.url_resolved || '',
                    isLive: true,
                }));

                filteredStreams = [...allStreams];
                renderStreams();
                
                loading.style.display = 'none';
                streamsSection.style.display = 'block';

            } catch (error) {
                console.error('Error:', error);
                loading.style.display = 'none';
                errorMessage.style.display = 'block';
                document.getElementById('errorText').textContent = 'Failed to load streams. Click retry or check your connection.';
            }
        }

        // Render streams
        function renderStreams() {
            const grid = document.getElementById('streamsGrid');
            grid.innerHTML = '';

            filteredStreams.forEach(stream => {
                const card = document.createElement('div');
                card.className = 'stream-card';
                card.onclick = () => playStream(stream);
                
                card.innerHTML = `
                    <div class="stream-thumbnail">
                        ${stream.thumbnail ? 
                            `<img src="${stream.thumbnail}" alt="${stream.title}" style="width: 100%; height: 100%; object-fit: cover;">` :
                            `<svg width="80" height="80" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                                <defs>
                                    <linearGradient id="fireGrad${stream.id}" x1="0%" y1="0%" x2="0%" y2="100%">
                                        <stop offset="0%" style="stop-color:#ff4500;stop-opacity:1" />
                                        <stop offset="100%" style="stop-color:#ff8c00;stop-opacity:1" />
                                    </linearGradient>
                                </defs>
                                <path d="M50 10 Q40 30 45 50 Q35 45 30 60 Q25 75 35 85 Q45 95 55 95 Q65 95 75 85 Q85 75 80 60 Q75 45 65 50 Q70 30 60 10 Q55 20 50 10 Z" fill="url(#fireGrad${stream.id})"/>
                                <path d="M50 40 Q48 45 49 52 Q47 50 45 55 Q43 60 47 65 Q50 68 53 65 Q57 60 55 55 Q53 50 51 52 Q52 45 50 40 Z" fill="#ff1744"/>
                            </svg>`
                        }
                        <div class="live-badge">
                            <span class="live-dot"></span>
                            LIVE
                        </div>
                    </div>
                    <div class="stream-info">
                        <h3 class="stream-title">${stream.title}</h3>
                        <p class="stream-author">${stream.author}</p>
                        <span class="category-tag">${stream.category}</span>
                        <div class="stream-stats">
                            <span class="listeners">üë• ${stream.listeners.toLocaleString()} listening</span>
                            <button class="play-button" onclick="event.stopPropagation(); playStream(${JSON.stringify(stream).replace(/"/g, '&quot;')})">‚ñ∂ Play</button>
                        </div>
                    </div>
                `;
                
                grid.appendChild(card);
            });
        }

        // Play stream
        function playStream(stream) {
            if (typeof stream === 'string') {
                stream = JSON.parse(stream);
            }
            
            currentStream = stream;
            audioPlayer.src = stream.url;
            audioPlayer.play();
            isPlaying = true;
            
            document.getElementById('playerBar').style.display = 'flex';
            document.getElementById('playerTitle').textContent = stream.title;
            document.getElementById('playerAuthor').textContent = stream.author;
            document.getElementById('playPauseBtn').textContent = '‚è∏';
            
            if (stream.thumbnail) {
                document.getElementById('playerThumbnail').innerHTML = 
                    `<img src="${stream.thumbnail}" alt="" style="width: 100%; height: 100%; border-radius: 10px;">`;
            }
        }

        // Toggle play/pause
        function togglePlayPause() {
            if (isPlaying) {
                audioPlayer.pause();
                document.getElementById('playPauseBtn').textContent = '‚ñ∂';
            } else {
                audioPlayer.play();
                document.getElementById('playPauseBtn').textContent = '‚è∏';
            }
            isPlaying = !isPlaying;
        }

        // Handle volume
        function handleVolumeChange() {
            const volume = document.getElementById('volumeSlider').value;
            audioPlayer.volume = volume / 100;
            document.getElementById('volumeText').textContent = volume + '%';
        }

        // Search
        function handleSearch() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            
            if (!query.trim()) {
                filteredStreams = [...allStreams];
            } else {
                filteredStreams = allStreams.filter(stream =>
                    stream.title.toLowerCase().includes(query) ||
                    stream.author.toLowerCase().includes(query) ||
                    stream.category.toLowerCase().includes(query)
                );
            }
            
            renderStreams();
        }

        // Filter by category
        function handleFilter(category) {
            // Update active button
            document.querySelectorAll('.filter-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            if (category === 'All') {
                filteredStreams = [...allStreams];
            } else {
                filteredStreams = allStreams.filter(stream =>
                    stream.category.toLowerCase().includes(category.toLowerCase())
                );
            }
            
            renderStreams();
        }

        // Enter key for search
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('searchInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') handleSearch();
            });
        });
    </script>
</body>
</html>
